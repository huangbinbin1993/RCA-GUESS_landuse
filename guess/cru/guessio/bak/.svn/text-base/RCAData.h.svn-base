//////////////////////////////////////////////////////////////////////////////////////
// RCADATA.H
// Header file for input from a fast data archive
// Created automatically by FastArchive on Fri Jul 31 00:22:38 2015
//
// The following #includes should appear in your source code file:
//
//   #include <stdio.h>
//   #include <stdlib.h>
//   #include <string.h>
//   #include "RCAData.h"
//
// Functionality to retrieve data from the archive is provided by class RCADataArchive.
// The following public functions are provided:
//
// bool open(char* filename)
//   Attempts to open the specified file as a fast data archive. The format must be
//   exactly compatible with this version of RCAData.h (normally the archive and
//   header file should have been produced together by the same program using class
//   CFastArchive). Returns false if the file could not be opened or had format
//   errors. open() with no argument is equivalent to open("RCAData.bin").
//
// void close()
//   Closes the archive (if open).
//
// bool rewind()
//   Sets the file pointer to the first record in the archive file. Returns false if
//   no archive file is currently open.
//
// bool getnext(RCAData& obj)
//   Retrieves the next record in the archive file and advances the file pointer to
//   the next record. Data are written to the member variables of obj. Returns false if
//   no archive file is currently open or if the file pointer is beyond the last
//   record. Use rewind() and getnext() to retrieve data sequentially from the archive.
//
// bool getindex(RCAData& obj)
//   Searches the archive for a record matching the values specified for the index
//   items (lon and lat) in obj. If a matching record is found, the data are
//   written to the member variables of obj. Returns true if the archive was open and
//   a matching record was found, otherwise false. The search is iterative and fast.
//
// Sample program:
//
//   RCADataArchive ark;
//   RCAData data;
//   bool success,flag;
//
//   // Retrieve all records in sequence and print values of lon and lat:
//
//   success=ark.open("RCAData.bin");
//   if (success) {
//      flag=ark.rewind();
//      while (flag) {
//         flag=ark.getnext(data);
//         if (flag)
//            printf("Loaded record: lon=%g, lat=%g\n",data.lon,data.lat);
//      }
//   }
//   
//   // Look for a record with lon=-180, lat=-90:
//
//   data.lon=-180;
//   data.lat=-90;
//   success=ark.getindex(data);
//   if (success) printf("Found it!\n");
//   else printf("Not found\n");
//
//   ark.close();


struct RCAData {

	// Index part

	double lon;
	double lat;

	// Data part

	double mtemp_for[360];
	double mtemp_soil_for[360];
	double mwcont_upper_for[360];
	double mwcont_lower_for[360];
	double mpar_for[360];
	double mprec_for[360];
	double mtemp_open[360];
	double mtemp_soil_open[360];
	double mwcont_upper_open[360];
	double mwcont_lower_open[360];
	double mpar_open[360];
	double mprec_open[360];
};


const long RCADATA_NRECORD=8751;
const int RCADATA_DATA_LENGTH=5760;
const int RCADATA_INDEX_LENGTH=7;
const int RCADATA_HEADERSIZE=1609;
unsigned char RCADATA_HEADER[RCADATA_HEADERSIZE-4]={
	0x01,0x06,0x49,0x00,0x00,0x00,0x07,0x00,0x02,0x04,0x6C,0x6F,0x6E,0x00,0x2D,0x31,0x38,0x30,0x00,0x00,
	0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x04,0x02,0x00,0x07,0x00,0x00,0x1E,0x40,0x04,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x38,0x30,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,
	0x00,0x00,0x04,0x02,0x00,0x07,0x00,0x00,0x1E,0x40,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x2E,
	0x32,0x35,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x04,0x02,0x00,0x07,0x00,0x00,
	0x1E,0x40,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B,0x04,0x6C,0x61,0x74,0x00,0x2D,0x39,0x30,0x00,
	0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x04,0x02,0x00,0x07,0x00,0x00,0x1E,0x40,
	0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x39,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,
	0xE3,0x2A,0x00,0x00,0x04,0x02,0x00,0x07,0x00,0x00,0x1E,0x40,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x30,0x2E,0x32,0x35,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x04,0x02,0x00,0x07,
	0x00,0x00,0x1E,0x40,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0x00,0x00,0x16,0x80,0x00,0x0C,0x0A,
	0x6D,0x74,0x65,0x6D,0x70,0x5F,0x66,0x6F,0x72,0x00,0x2D,0x31,0x30,0x30,0x00,0x00,0x00,0x00,0x4D,0xDA,
	0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,0x0C,0x16,0x80,0x00,0x00,0x1E,0x40,0x0A,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x31,0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,0x0C,
	0x16,0x80,0x00,0x00,0x1E,0x40,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x2E,0x31,0x00,0x00,0x00,
	0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,0x0C,0x16,0x80,0x00,0x00,0x1E,0x40,0x0A,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x0B,0x00,0x00,0x01,0x68,0x0F,0x6D,0x74,0x65,0x6D,0x70,0x5F,0x73,0x6F,
	0x69,0x6C,0x5F,0x66,0x6F,0x72,0x00,0x2D,0x31,0x30,0x30,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,
	0x2A,0x00,0x00,0x0F,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,
	0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0F,0x00,0x01,0x68,0x00,
	0x00,0x1E,0x40,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x2E,0x31,0x00,0x00,0x00,0x00,0x00,0x4D,
	0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0F,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0F,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x0B,0x00,0x00,0x01,0x68,0x11,0x6D,0x77,0x63,0x6F,0x6E,0x74,0x5F,0x75,0x70,0x70,0x65,
	0x72,0x5F,0x66,0x6F,0x72,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,
	0x00,0x00,0x11,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x11,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x11,0x00,0x01,0x68,0x00,0x00,
	0x1E,0x40,0x11,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x2E,0x30,0x31,0x00,0x00,0x00,0x00,0x4D,0xDA,
	0xDA,0x25,0xE3,0x2A,0x00,0x00,0x11,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x11,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x07,0x00,0x00,0x01,0x68,0x11,0x6D,0x77,0x63,0x6F,0x6E,0x74,0x5F,0x6C,0x6F,0x77,0x65,0x72,
	0x5F,0x66,0x6F,0x72,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,
	0x00,0x11,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x11,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x11,0x00,0x01,0x68,0x00,0x00,0x1E,
	0x40,0x11,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x2E,0x30,0x31,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,
	0x25,0xE3,0x2A,0x00,0x00,0x11,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x11,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x07,0x00,0x00,0x01,0x68,0x09,0x6D,0x70,0x61,0x72,0x5F,0x66,0x6F,0x72,0x00,0x30,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x09,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,
	0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x32,0x30,0x30,0x30,0x30,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,
	0xE3,0x2A,0x00,0x00,0x09,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x31,0x30,0x00,0x30,0x30,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x09,0x00,0x01,0x68,
	0x00,0x00,0x1E,0x40,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B,0x00,0x00,0x01,0x68,0x0A,0x6D,0x70,
	0x72,0x65,0x63,0x5F,0x66,0x6F,0x72,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,
	0xE3,0x2A,0x00,0x00,0x0A,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x31,0x30,0x30,0x30,0x30,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,0x00,0x01,0x68,
	0x00,0x00,0x1E,0x40,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x2E,0x31,0x00,0x30,0x00,0x00,0x00,
	0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0A,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x11,0x00,0x00,0x01,0x68,0x0B,0x6D,0x74,0x65,0x6D,0x70,0x5F,0x6F,0x70,0x65,0x6E,
	0x00,0x2D,0x31,0x30,0x30,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0B,0x00,0x01,
	0x68,0x00,0x00,0x1E,0x40,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x30,0x30,0x00,0x00,0x00,0x00,
	0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0B,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0B,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x30,0x2E,0x31,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,
	0x00,0x0B,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B,0x00,0x00,
	0x01,0x68,0x10,0x6D,0x74,0x65,0x6D,0x70,0x5F,0x73,0x6F,0x69,0x6C,0x5F,0x6F,0x70,0x65,0x6E,0x00,0x2D,
	0x31,0x30,0x30,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x10,0x00,0x01,0x68,0x00,
	0x00,0x1E,0x40,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x4D,
	0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x10,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x10,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x30,0x2E,0x31,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x10,
	0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B,0x00,0x00,0x01,0x68,
	0x12,0x6D,0x77,0x63,0x6F,0x6E,0x74,0x5F,0x75,0x70,0x70,0x65,0x72,0x5F,0x6F,0x70,0x65,0x6E,0x00,0x30,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x12,0x00,0x01,0x68,0x00,
	0x00,0x1E,0x40,0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,
	0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x12,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x12,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x30,0x2E,0x30,0x31,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x12,
	0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x00,0x01,0x68,
	0x12,0x6D,0x77,0x63,0x6F,0x6E,0x74,0x5F,0x6C,0x6F,0x77,0x65,0x72,0x5F,0x6F,0x70,0x65,0x6E,0x00,0x30,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x12,0x00,0x01,0x68,0x00,
	0x00,0x1E,0x40,0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,
	0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x12,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x12,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x30,0x2E,0x30,0x31,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x12,
	0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x00,0x01,0x68,
	0x0A,0x6D,0x70,0x61,0x72,0x5F,0x6F,0x70,0x65,0x6E,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,
	0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0A,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x32,0x30,0x30,0x30,0x30,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,
	0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x30,0x00,0x30,0x30,
	0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0A,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0A,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B,0x00,0x00,0x01,0x68,0x0B,0x6D,0x70,0x72,0x65,0x63,0x5F,0x6F,
	0x70,0x65,0x6E,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,
	0x0B,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x30,0x30,0x30,
	0x30,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,0xE3,0x2A,0x00,0x00,0x0B,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,
	0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x2E,0x31,0x00,0x30,0x00,0x00,0x00,0x4D,0xDA,0xDA,0x25,
	0xE3,0x2A,0x00,0x00,0x0B,0x00,0x01,0x68,0x00,0x00,0x1E,0x40,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x11,0x00,0x00,0x01,0x68};


class RCADataArchive {

private:

	FILE* pfile;
	long recno;
	long datano;
	unsigned char pindex[RCADATA_INDEX_LENGTH];
	unsigned char pdata[RCADATA_DATA_LENGTH];
	bool iseof;

	long readbin(int nbyte) {

		unsigned char buf[4];
		long mult[4]={0x1000000,0x10000,0x100,1},val;
		int i;

		fread(buf,nbyte,1,pfile);

		val=0;
		for (i=0;i<nbyte;i++) {
			val+=buf[i]*mult[4-nbyte+i];
		}

		return val;
	}

	void getindex(long n) {

		fseek(pfile,RCADATA_INDEX_LENGTH*(n-recno),SEEK_CUR);
		fread(pindex,RCADATA_INDEX_LENGTH,1,pfile);
		datano=pindex[RCADATA_INDEX_LENGTH-4]*0x1000000+pindex[RCADATA_INDEX_LENGTH-3]*0x10000+
			pindex[RCADATA_INDEX_LENGTH-2]*0x100+pindex[RCADATA_INDEX_LENGTH-1];
		recno=n+1;
		iseof=(recno==RCADATA_NRECORD);
	}

	void getdata() {

		fseek(pfile,RCADATA_INDEX_LENGTH*-recno+(datano-RCADATA_NRECORD)*RCADATA_DATA_LENGTH,SEEK_CUR);
		fread(pdata,RCADATA_DATA_LENGTH,1,pfile);
		fseek(pfile,RCADATA_DATA_LENGTH*(RCADATA_NRECORD-datano-1)+RCADATA_INDEX_LENGTH*recno,SEEK_CUR);
	}

	double popreal(unsigned char* bits,int nbyte,int nbit,double scalar,double offset) {

		unsigned char buf;
		int nb=nbit/8,i;
		double rval=0.0;
		long mult[4]={1,0x100,0x10000,0x1000000};

		for (i=0;i<4;i++) {
			if (i<nb) rval+=bits[nbyte-i-1]*mult[i];
			else if (i==nb) {
				buf=bits[nbyte-i-1]<<(8-nbit%8);
				buf>>=8-nbit%8;
				rval+=buf*mult[i];
			}
		}

		for (i=nbyte-1;i>=0;i--) {
			if (i>=nb)
				bits[i]=bits[i-nb];
			else
				bits[i]=0;
		}

		nb=nbit%8;

		for (i=nbyte-1;i>=0;i--) {
			bits[i]>>=nb;
			if (i>0) {
				buf=bits[i-1];
				buf<<=8-nb;
				bits[i]|=buf;
			}
		}

		rval=rval*scalar+offset;

		return rval;
	}

	void bitify(unsigned char buf[4],double fval,double offset,double scalar) {

		long ival = (long)((fval-offset)/scalar + 0.5);
		buf[0]=(unsigned char)(ival/0x1000000);
		ival-=buf[0]*0x1000000;
		buf[1]=(unsigned char)(ival/0x10000);
		ival-=buf[1]*0x10000;
		buf[2]=(unsigned char)(ival/0x100);
		ival-=buf[2]*0x100;
		buf[3]=(unsigned char)(ival);
	}

	void merge(unsigned char ptarget[3],unsigned char buf[4],int bits) {

		int nb=bits/8;
		int i;
		unsigned char nib;
		for (i=0;i<3;i++) {

			if (i<3-nb)
				ptarget[i]=ptarget[i+nb];
			else
				ptarget[i]=0;
		}
		nb=bits%8;
		for (i=0;i<3;i++) {
			ptarget[i]<<=nb;
			if (i<3-1) {
				nib=ptarget[i+1]>>(8-nb);
				ptarget[i]|=nib;
			}
		}

		nb=bits/8;
		if (bits%8) nb++;
		for (i=1;i<=nb;i++)
			ptarget[3-i]|=buf[4-i];
	}

	int compare_index(unsigned char* a,unsigned char* b) {

		int i;
		for (i=0;i<3;i++) {
			if (a[i]<b[i]) return -1;
			else if (a[i]>b[i]) return +1;
		}

		return 0;
	}

	bool initialise(const char* filename) {

		int i;
		unsigned char* pheader;

		if (pfile) fclose(pfile);
		pfile=fopen(filename,"rb");
		if (!pfile) {
			printf("Could not open %s for input\n",filename);
			return false;
		}

		pheader=new unsigned char[RCADATA_HEADERSIZE-4];
		if (!pheader) {
			printf("Out of memory\n");
			fclose(pfile);
			pfile=NULL;
			return false;
		}
		::rewind(pfile);
		fread(pheader,RCADATA_HEADERSIZE-4,1,pfile);
		for (i=0;i<RCADATA_HEADERSIZE-4;i++) {
			if (pheader[i]!=RCADATA_HEADER[i]) {
				printf("Format of %s incompatible with this version of RCAData.h\n",filename);
				fclose(pfile);
				pfile=NULL;
				delete pheader;
				return false;
			}
		}
		delete[] pheader;

		::rewind(pfile);
		fseek(pfile,RCADATA_HEADERSIZE+RCADATA_DATA_LENGTH*RCADATA_NRECORD,SEEK_CUR);
		recno=0;
		iseof=false;

		return true;
	}

public:

	RCADataArchive() {
		pfile=NULL;
	}

	~RCADataArchive() {
		if (pfile) fclose(pfile);
	}

	bool open(const char* filename) {
		return initialise(filename);
	}

	bool open() {
		return open("RCAData.bin");
	}

	void close() {
		if (pfile) {
			fclose(pfile);
			pfile=NULL;
		}
	}

	bool rewind() {

		if (!pfile) return false;

		::rewind(pfile);
		fseek(pfile,RCADATA_HEADERSIZE+RCADATA_DATA_LENGTH*RCADATA_NRECORD,SEEK_CUR);
		recno=0;
		iseof=false;

		return true;
	}

	bool getnext(RCAData& obj) {

		if (!pfile || iseof) return false;

		int i;

		getindex(recno);
		getdata();

		obj.lat=popreal(pindex,3,10,0.25,-90);
		obj.lon=popreal(pindex,3,11,0.25,-180);

		for (i=359;i>=0;i--) obj.mprec_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,17,0.1,0);
		for (i=359;i>=0;i--) obj.mpar_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,10,0);
		for (i=359;i>=0;i--) obj.mwcont_lower_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
		for (i=359;i>=0;i--) obj.mwcont_upper_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
		for (i=359;i>=0;i--) obj.mtemp_soil_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);
		for (i=359;i>=0;i--) obj.mtemp_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);
		for (i=359;i>=0;i--) obj.mprec_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,17,0.1,0);
		for (i=359;i>=0;i--) obj.mpar_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,10,0);
		for (i=359;i>=0;i--) obj.mwcont_lower_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
		for (i=359;i>=0;i--) obj.mwcont_upper_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
		for (i=359;i>=0;i--) obj.mtemp_soil_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);
		for (i=359;i>=0;i--) obj.mtemp_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);

		return true;
	}

	bool getindex(RCAData& obj) {

		if (!RCADATA_NRECORD || !pfile) return false;

		// else

		unsigned char ptarget[3]={0,0,0};
		unsigned char buf[4];
		bitify(buf,obj.lon,-180,0.25);
		merge(ptarget,buf,11);
		bitify(buf,obj.lat,-90,0.25);
		merge(ptarget,buf,10);

		long begin = 0;
		long end = RCADATA_NRECORD;

		while (begin < end) {
			long middle = (begin+end)/2;

			getindex(middle);
			getdata();

			int c = compare_index(pindex, ptarget);

			if (c < 0) {
				begin = middle + 1;
			}
			else if (c > 0) {
				end = middle;
			}
			else {

				for (int i=359;i>=0;i--) obj.mprec_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,17,0.1,0);
				for (int i=359;i>=0;i--) obj.mpar_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,10,0);
				for (int i=359;i>=0;i--) obj.mwcont_lower_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
				for (int i=359;i>=0;i--) obj.mwcont_upper_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
				for (int i=359;i>=0;i--) obj.mtemp_soil_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);
				for (int i=359;i>=0;i--) obj.mtemp_open[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);
				for (int i=359;i>=0;i--) obj.mprec_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,17,0.1,0);
				for (int i=359;i>=0;i--) obj.mpar_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,10,0);
				for (int i=359;i>=0;i--) obj.mwcont_lower_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
				for (int i=359;i>=0;i--) obj.mwcont_upper_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,7,0.01,0);
				for (int i=359;i>=0;i--) obj.mtemp_soil_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);
				for (int i=359;i>=0;i--) obj.mtemp_for[i]=popreal(pdata,RCADATA_DATA_LENGTH,11,0.1,-100);

				return true;
			}
		}

		return false;
	}
};
